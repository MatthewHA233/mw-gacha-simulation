<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>现代战舰 - 抽奖模拟器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a4a 0%, #0d1525 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #90a4ae;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .lottery-section {
            background: rgba(30, 40, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
        }

        .preview-section {
            grid-column: 1 / -1;
            background: rgba(30, 40, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
            position: relative;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .info-button {
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid rgba(79, 195, 247, 0.5);
            color: #4fc3f7;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .preview-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .preview-item {
            background: rgba(20, 30, 48, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(79, 195, 247, 0.2);
            position: relative;
        }
        
        .preview-item-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .preview-item-rarity {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        .preview-item-probability {
            font-size: 0.7rem;
            color: #90a4ae;
        }
        
        .preview-item-type {
            font-size: 0.7rem;
            color: #90a4ae;
            margin-top: 3px;
        }
        
        .limited-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            font-size: 0.6rem;
            padding: 2px 5px;
            border-radius: 8px;
        }
        
        .settings-section {
            width: 100%;
            background: rgba(30, 40, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
            margin-top: 20px;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .settings-content {
            display: none;
            margin-top: 20px;
        }
        
        .settings-content.expanded {
            display: block;
        }
        
        .lottery-machine {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .lottery-display {
            height: 200px;
            background: rgba(20, 30, 48, 0.8);
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(79, 195, 247, 0.3);
        }
        
        .lottery-item {
            display: none;
            text-align: center;
            padding: 15px;
            animation: fadeIn 0.5s;
        }
        
        .lottery-item.active {
            display: block;
        }
        
        .item-name {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .item-rarity {
            font-size: 1.2rem;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .rarity-common {
            background: rgba(144, 164, 174, 0.3);
            color: #90a4ae;
        }
        
        .rarity-rare {
            background: rgba(41, 182, 246, 0.3);
            color: #29b6f6;
        }
        
        /* 史诗改为金色 */
        .rarity-epic {
            background: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }
        
        /* 传说改为紫色 */
        .rarity-legendary {
            background: rgba(171, 71, 188, 0.3);
            color: #ab47bc;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .single-draw {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }
        
        .multi-draw {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }
        
        .add-currency {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        
        .toggle-settings {
            background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);
        }
        
        .view-all-history {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
            margin-top: 10px;
            width: 100%;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.6);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            background: #546e7a;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .resources {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(20, 30, 48, 0.6);
            border-radius: 10px;
        }
        
        .resource-item {
            text-align: center;
        }
        
        .resource-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .resource-label {
            font-size: 0.9rem;
            color: #90a4ae;
        }
        
        .history-section {
            background: rgba(30, 40, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4fc3f7;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .history-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(20, 30, 48, 0.6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s;
        }
        
        .history-rarity {
            width: 10px;
            height: 40px;
            border-radius: 5px;
        }
        
        .rarity-common-bg {
            background: #90a4ae;
        }
        
        .rarity-rare-bg {
            background: #29b6f6;
        }
        
        /* 史诗改为金色 */
        .rarity-epic-bg {
            background: #ffc107;
        }
        
        /* 传说改为紫色 */
        .rarity-legendary-bg {
            background: #ab47bc;
        }
        
        .history-info {
            flex: 1;
        }
        
        .history-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .history-type {
            font-size: 0.9rem;
            color: #90a4ae;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(20, 30, 48, 0.6);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4fc3f7;
            margin: 8px 0;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #90a4ae;
        }
        
        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: bold;
            color: #4fc3f7;
        }
        
        input, select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            background: rgba(20, 30, 48, 0.8);
            color: #e0e0e0;
            font-size: 1rem;
        }
        
        .items-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background: rgba(20, 30, 48, 0.6);
            border-radius: 8px;
        }
        
        .item-row {
            display: flex;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
        }
        
        .item-row:last-child {
            border-bottom: none;
        }
        
        .item-name-input {
            flex: 2;
        }
        
        .item-type-select {
            flex: 1;
        }
        
        .item-rarity-select {
            flex: 1;
        }
        
        .item-probability-input {
            flex: 1;
        }
        
        .item-limit-input {
            flex: 1;
        }
        
        .item-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.9rem;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }
        
        .total-probability {
            margin-top: 10px;
            padding: 10px;
            background: rgba(20, 30, 48, 0.8);
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .probability-warning {
            color: #ff9800;
        }
        
        .probability-error {
            color: #f44336;
        }
        
        .probability-ok {
            color: #4caf50;
        }
        
        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .modal-content {
            background: rgba(30, 40, 60, 0.95);
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(79, 195, 247, 0.5);
            border: 2px solid rgba(79, 195, 247, 0.3);
            animation: modalFadeIn 0.5s;
            overscroll-behavior: contain;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .modal-title {
            font-size: 1.8rem;
            color: #4fc3f7;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .modal-item {
            background: rgba(20, 30, 48, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .modal-item-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .modal-item-rarity {
            font-size: 0.9rem;
            padding: 3px 10px;
            border-radius: 15px;
            display: inline-block;
        }
        
        .modal-item-type {
            font-size: 0.8rem;
            color: #90a4ae;
            margin-top: 5px;
        }
        
        /* 奖品信息弹窗样式 */
        .info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .info-modal-content {
            background: rgba(30, 40, 60, 0.95);
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(79, 195, 247, 0.5);
            border: 2px solid rgba(79, 195, 247, 0.3);
            animation: modalFadeIn 0.5s;
            width: 800px;
            overscroll-behavior: contain;
        }
        
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .info-table th, .info-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-table th {
            background: rgba(20, 30, 48, 0.8);
            color: #4fc3f7;
            font-weight: bold;
        }
        
        .info-table tr:hover {
            background: rgba(79, 195, 247, 0.1);
        }
        
        /* 历史记录弹窗样式 */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .history-modal-content {
            background: rgba(30, 40, 60, 0.95);
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(79, 195, 247, 0.5);
            border: 2px solid rgba(79, 195, 247, 0.3);
            animation: modalFadeIn 0.5s;
            width: 600px;
            overscroll-behavior: contain;
        }
        
        .history-modal-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease-in-out;
        }
        
        .drawing {
            animation: pulse 0.3s infinite;
        }
        
        /* 响应式设计 */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .preview-section {
                grid-column: 1;
            }

            .stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .preview-section {
                grid-column: 1;
            }

            .preview-items {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                max-height: 300px;
            }

            .controls {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .resources {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            button {
                width: 100%;
                flex-direction: row;
                gap: 8px;
            }

            .item-row {
                flex-direction: column;
            }

            .modal-items {
                grid-template-columns: 1fr;
            }

            .info-modal-content {
                width: 95%;
            }

            .history-modal-content {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>现代战舰 - 抽奖模拟器</h1>
            <p class="subtitle">体验《现代战舰》中的抽奖活动，测试你的运气！</p>
        </header>
        
        <div class="main-content">
            <section class="lottery-section">
                <h2 class="section-title">暗影交易</h2>
                
                <div class="lottery-machine">
                    <div class="lottery-display" id="lotteryDisplay">
                        <div class="lottery-item active" id="defaultDisplay">
                            <p>点击下方按钮开始抽奖</p>
                            <p style="margin-top: 10px; font-size: 3rem;">🎁</p>
                        </div>
                    </div>
                    
                    <div class="resources">
                        <div class="resource-item">
                            <div class="resource-value" id="goldValue">40</div>
                            <div class="resource-label" id="currencyName">筹码</div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-value" id="totalDraws">0</div>
                            <div class="resource-label">总抽奖次数</div>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button class="single-draw" id="singleDrawBtn">
                            <span>单抽</span>
                            <span id="singleCost">(1筹码)</span>
                        </button>
                        <button class="multi-draw" id="multiDrawBtn">
                            <span>十连抽</span>
                            <span id="multiCost">(10筹码)</span>
                        </button>
                        <button class="add-currency" id="addCurrencyBtn">
                            <span>增加货币</span>
                        </button>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">传奇物品</div>
                        <div class="stat-value" id="legendaryCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">史诗物品</div>
                        <div class="stat-value" id="epicCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">稀有物品</div>
                        <div class="stat-value" id="rareCount">0</div>
                    </div>
                </div>
            </section>
            
            <section class="preview-section">
                <div class="preview-header">
                    <h2 class="section-title">大奖预览</h2>
                    <div class="info-button" id="infoButton">i</div>
                </div>
                <div class="preview-items" id="previewItems">
                    <!-- 奖品预览将在这里动态生成 -->
                </div>
            </section>
            
            <section class="history-section">
                <h2 class="section-title">抽奖记录</h2>
                <div class="history-list" id="historyList">
                    <!-- 抽奖记录将在这里动态生成 -->
                </div>
                <button class="view-all-history" id="viewAllHistoryBtn">查看全部记录</button>
            </section>
        </div>
        
        <section class="settings-section">
            <div class="settings-header" id="settingsToggle">
                <h2 class="section-title">自定义设置</h2>
                <button class="toggle-settings">展开设置</button>
            </div>
            
            <div class="settings-content" id="settingsContent">
                <div class="settings-form">
                    <div class="form-group">
                        <label for="currencyNameInput">货币名称</label>
                        <input type="text" id="currencyNameInput" value="筹码">
                    </div>
                    
                    <div class="form-group">
                        <label for="currencyCostInput">单次抽奖所需货币</label>
                        <input type="number" id="currencyCostInput" value="1" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="initialCurrencyInput">初始货币数量</label>
                        <input type="number" id="initialCurrencyInput" value="40" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>奖品设置</label>
                        <div class="items-list" id="itemsList">
                            <!-- 奖品列表将在这里动态生成 -->
                        </div>
                        <button class="btn-small" id="addItemBtn">添加奖品</button>
                        <div class="total-probability" id="totalProbability">
                            总概率: 0.00%
                        </div>
                    </div>
                    
                    <button id="saveSettingsBtn">保存设置</button>
                </div>
            </div>
        </section>
    </div>

    <!-- 抽奖结果弹窗 -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">抽奖结果</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-items" id="modalItems">
                <!-- 奖品将在这里显示 -->
            </div>
        </div>
    </div>

    <!-- 奖品信息弹窗 -->
    <div class="info-modal" id="infoModal">
        <div class="info-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">所有奖品信息</h3>
                <button class="close-modal" id="closeInfoModal">&times;</button>
            </div>
            <table class="info-table">
                <thead>
                    <tr>
                        <th>奖品名称</th>
                        <th>类别</th>
                        <th>稀有度</th>
                        <th>概率</th>
                        <th>已抽中次数</th>
                        <th>限量</th>
                    </tr>
                </thead>
                <tbody id="infoTableBody">
                    <!-- 奖品信息将在这里动态生成 -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 历史记录弹窗 -->
    <div class="history-modal" id="historyModal">
        <div class="history-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">所有抽奖记录</h3>
                <button class="close-modal" id="closeHistoryModal">&times;</button>
            </div>
            <div class="history-modal-list" id="historyModalList">
                <!-- 所有历史记录将在这里显示 -->
            </div>
        </div>
    </div>

    <script>
        // 默认奖品数据
        const defaultItems = [
            // 普通物品
            { name: "2 高级鱼雷诱饵", type: "道具", rarity: "common", probability: 17.00, limit: 0, obtained: 0 },
            { name: "4 艺术硬币", type: "资源", rarity: "common", probability: 22.00, limit: 0, obtained: 0 },
            { name: "6 高级导弹诱饵", type: "道具", rarity: "common", probability: 12.50, limit: 0, obtained: 0 },
            { name: "10 艺术硬币", type: "资源", rarity: "common", probability: 8.00, limit: 0, obtained: 0 },
            { name: "1 筹码", type: "资源", rarity: "common", probability: 4.00, limit: 0, obtained: 0 },
            { name: "15 黄金", type: "资源", rarity: "common", probability: 33.00, limit: 0, obtained: 0 },
            
            // 史诗物品
            { name: "FREMM-EVO", type: "舰船", rarity: "epic", probability: 0.08, limit: 1, obtained: 0 },
            { name: "RBU-10000", type: "武器", rarity: "epic", probability: 1.53, limit: 1, obtained: 0 },
            { name: "萨克森(F124)", type: "武器", rarity: "epic", probability: 0.14, limit: 1, obtained: 0 },
            
            // 传奇物品
            { name: "衣阿华", type: "舰船", rarity: "legendary", probability: 0.09, limit: 1, obtained: 0 },
            { name: "MARK-71", type: "武器", rarity: "legendary", probability: 0.52, limit: 2, obtained: 0 },
            { name: "MARK-45 阿斯托尔", type: "武器", rarity: "legendary", probability: 0.23, limit: 2, obtained: 0 },
            { name: "ASN4G", type: "武器", rarity: "legendary", probability: 0.35, limit: 2, obtained: 0 },
            { name: "龟船", type: "皮肤", rarity: "legendary", probability: 0.50, limit: 1, obtained: 0 },
        ];

        // 游戏状态
        const gameState = {
            currency: 40,
            currencyName: "筹码",
            singleCost: 1,
            totalDraws: 0,
            legendaryCount: 0,
            epicCount: 0,
            rareCount: 0,
            history: [],
            items: [...defaultItems]
        };

        // DOM 元素
        const lotteryDisplay = document.getElementById('lotteryDisplay');
        const singleDrawBtn = document.getElementById('singleDrawBtn');
        const multiDrawBtn = document.getElementById('multiDrawBtn');
        const addCurrencyBtn = document.getElementById('addCurrencyBtn');
        const historyList = document.getElementById('historyList');
        const goldValue = document.getElementById('goldValue');
        const currencyName = document.getElementById('currencyName');
        const singleCost = document.getElementById('singleCost');
        const multiCost = document.getElementById('multiCost');
        const totalDraws = document.getElementById('totalDraws');
        const legendaryCount = document.getElementById('legendaryCount');
        const epicCount = document.getElementById('epicCount');
        const rareCount = document.getElementById('rareCount');
        const previewItems = document.getElementById('previewItems');
        const infoButton = document.getElementById('infoButton');
        const viewAllHistoryBtn = document.getElementById('viewAllHistoryBtn');
        
        // 设置相关DOM元素
        const currencyNameInput = document.getElementById('currencyNameInput');
        const currencyCostInput = document.getElementById('currencyCostInput');
        const initialCurrencyInput = document.getElementById('initialCurrencyInput');
        const itemsList = document.getElementById('itemsList');
        const addItemBtn = document.getElementById('addItemBtn');
        const totalProbability = document.getElementById('totalProbability');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const settingsToggle = document.getElementById('settingsToggle');
        const settingsContent = document.getElementById('settingsContent');
        
        // 弹窗相关DOM元素
        const resultModal = document.getElementById('resultModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalItems = document.getElementById('modalItems');
        const closeModal = document.getElementById('closeModal');
        const infoModal = document.getElementById('infoModal');
        const closeInfoModal = document.getElementById('closeInfoModal');
        const infoTableBody = document.getElementById('infoTableBody');
        const historyModal = document.getElementById('historyModal');
        const closeHistoryModal = document.getElementById('closeHistoryModal');
        const historyModalList = document.getElementById('historyModalList');

        // 根据稀有度获取颜色类
        function getRarityClass(rarity) {
            switch(rarity) {
                case 'common': return 'rarity-common';
                case 'rare': return 'rarity-rare';
                case 'epic': return 'rarity-epic';
                case 'legendary': return 'rarity-legendary';
                default: return 'rarity-common';
            }
        }

        // 根据稀有度获取背景颜色类
        function getRarityBgClass(rarity) {
            switch(rarity) {
                case 'common': return 'rarity-common-bg';
                case 'rare': return 'rarity-rare-bg';
                case 'epic': return 'rarity-epic-bg';
                case 'legendary': return 'rarity-legendary-bg';
                default: return 'rarity-common-bg';
            }
        }

        // 抽奖函数
        function drawLottery() {
            // 过滤掉已抽完的限量物品
            const availableItems = gameState.items.filter(item => {
                return item.limit === 0 || item.obtained < item.limit;
            });
            
            // 计算可用物品的总概率
            const totalProbability = availableItems.reduce((sum, item) => sum + item.probability, 0);
            
            // 生成随机数
            const rand = Math.random() * totalProbability;
            let cumulativeProbability = 0;
            
            // 根据概率确定奖品
            for (const item of availableItems) {
                cumulativeProbability += item.probability;
                if (rand < cumulativeProbability) {
                    return {...item};
                }
            }
            
            // 如果概率总和不足，返回最后一个物品
            return {...availableItems[availableItems.length - 1]};
        }

        // 更新资源显示
        function updateResources() {
            goldValue.textContent = gameState.currency;
            currencyName.textContent = gameState.currencyName;
            singleCost.textContent = `(${gameState.singleCost}${gameState.currencyName})`;
            multiCost.textContent = `(${gameState.singleCost * 10}${gameState.currencyName})`;
            totalDraws.textContent = gameState.totalDraws;
            legendaryCount.textContent = gameState.legendaryCount;
            epicCount.textContent = gameState.epicCount;
            rareCount.textContent = gameState.rareCount;
        }

        // 显示抽奖结果弹窗
        function showResultModal(items, isMulti = false) {
            modalTitle.textContent = isMulti ? '十连抽结果' : '抽奖结果';
            modalItems.innerHTML = '';
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'modal-item';
                itemElement.innerHTML = `
                    <div class="modal-item-name">${item.name}</div>
                    <div class="modal-item-rarity ${getRarityClass(item.rarity)}">${getRarityText(item.rarity)}</div>
                    <div class="modal-item-type">${item.type}</div>
                `;
                modalItems.appendChild(itemElement);
            });
            
            resultModal.style.display = 'flex';
            // 弹窗打开时滚动到顶部
            resultModal.querySelector('.modal-content').scrollTop = 0;
        }

        // 获取稀有度文本
        function getRarityText(rarity) {
            switch(rarity) {
                case 'common': return '普通';
                case 'rare': return '稀有';
                case 'epic': return '史诗';
                case 'legendary': return '传奇';
                default: return '普通';
            }
        }

        // 更新历史记录显示
        function updateHistory() {
            historyList.innerHTML = '';
            
            // 只显示最近10条记录
            const recentHistory = gameState.history.slice(0, 10);
            
            recentHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-rarity ${getRarityBgClass(item.rarity)}"></div>
                    <div class="history-info">
                        <div class="history-name">${item.name}</div>
                        <div class="history-type">${item.type}</div>
                    </div>
                    <div class="history-rarity-text ${getRarityClass(item.rarity)}">${getRarityText(item.rarity)}</div>
                `;
                
                historyList.appendChild(historyItem);
            });
        }

        // 显示所有历史记录弹窗
        function showAllHistory() {
            historyModalList.innerHTML = '';
            
            gameState.history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-rarity ${getRarityBgClass(item.rarity)}"></div>
                    <div class="history-info">
                        <div class="history-name">${item.name}</div>
                        <div class="history-type">${item.type}</div>
                    </div>
                    <div class="history-rarity-text ${getRarityClass(item.rarity)}">${getRarityText(item.rarity)}</div>
                `;
                
                historyModalList.appendChild(historyItem);
            });
            
            historyModal.style.display = 'flex';
            // 弹窗打开时滚动到顶部
            historyModal.querySelector('.history-modal-content').scrollTop = 0;
        }

        // 更新奖品预览
        function updatePreview() {
            previewItems.innerHTML = '';
            
            // 筛选史诗和传说物品，并按概率从低到高排序
            const premiumItems = gameState.items
                .filter(item => item.rarity === 'epic' || item.rarity === 'legendary')
                .sort((a, b) => a.probability - b.probability);
            
            premiumItems.forEach(item => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                let limitBadge = '';
                if (item.limit > 0) {
                    const remaining = item.limit - item.obtained;
                    limitBadge = `<div class="limited-badge">${remaining}/${item.limit}</div>`;
                }
                
                previewItem.innerHTML = `
                    ${limitBadge}
                    <div class="preview-item-name">${item.name}</div>
                    <div class="preview-item-rarity ${getRarityClass(item.rarity)}">${getRarityText(item.rarity)}</div>
                    <div class="preview-item-probability">${item.probability.toFixed(2)}%</div>
                    <div class="preview-item-type">${item.type}</div>
                `;
                
                previewItems.appendChild(previewItem);
            });
        }

        // 更新奖品信息表
        function updateInfoTable() {
            infoTableBody.innerHTML = '';
            
            // 按稀有度排序：传说 > 史诗 > 稀有 > 普通
            const sortedItems = [...gameState.items].sort((a, b) => {
                const rarityOrder = { legendary: 4, epic: 3, rare: 2, common: 1 };
                return rarityOrder[b.rarity] - rarityOrder[a.rarity] || a.probability - b.probability;
            });
            
            sortedItems.forEach(item => {
                const row = document.createElement('tr');
                
                let limitText = '无限制';
                if (item.limit > 0) {
                    limitText = `${item.obtained}/${item.limit}`;
                }
                
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.type}</td>
                    <td><span class="${getRarityClass(item.rarity)}" style="padding: 3px 8px; border-radius: 10px;">${getRarityText(item.rarity)}</span></td>
                    <td>${item.probability.toFixed(2)}%</td>
                    <td>${item.obtained}</td>
                    <td>${limitText}</td>
                `;
                
                infoTableBody.appendChild(row);
            });
        }

        // 单抽
        function singleDraw() {
            if (gameState.currency < gameState.singleCost) {
                alert(`${gameState.currencyName}不足！`);
                return;
            }
            
            // 消耗资源
            gameState.currency -= gameState.singleCost;
            gameState.totalDraws++;
            
            // 禁用按钮
            singleDrawBtn.disabled = true;
            multiDrawBtn.disabled = true;
            
            // 添加绘制动画
            lotteryDisplay.classList.add('drawing');
            
            // 模拟抽奖延迟
            setTimeout(() => {
                const result = drawLottery();
                
                // 更新物品的已抽中次数
                const itemIndex = gameState.items.findIndex(item => 
                    item.name === result.name && item.rarity === result.rarity
                );
                if (itemIndex !== -1) {
                    gameState.items[itemIndex].obtained++;
                }
                
                // 添加到历史记录（放在最前面）
                gameState.history.unshift(result);
                
                // 显示弹窗
                showResultModal([result]);
                
                // 更新统计
                if (result.rarity === 'legendary') gameState.legendaryCount++;
                if (result.rarity === 'epic') gameState.epicCount++;
                if (result.rarity === 'rare') gameState.rareCount++;
                
                // 更新资源显示
                updateResources();
                
                // 更新预览和信息表
                updatePreview();
                updateInfoTable();
                updateHistory();
                
                // 启用按钮
                singleDrawBtn.disabled = false;
                multiDrawBtn.disabled = false;
                lotteryDisplay.classList.remove('drawing');
                
                // 检查资源是否足够
                checkResources();
            }, 1000);
        }

        // 十连抽
        function multiDraw() {
            const cost = gameState.singleCost * 10;
            if (gameState.currency < cost) {
                alert(`${gameState.currencyName}不足！`);
                return;
            }
            
            // 消耗资源
            gameState.currency -= cost;
            gameState.totalDraws += 10;
            
            // 禁用按钮
            singleDrawBtn.disabled = true;
            multiDrawBtn.disabled = true;
            
            // 添加绘制动画
            lotteryDisplay.classList.add('drawing');
            
            // 模拟抽奖延迟
            setTimeout(() => {
                // 抽10次
                let results = [];
                for (let i = 0; i < 10; i++) {
                    const result = drawLottery();
                    results.push(result);
                    
                    // 更新物品的已抽中次数
                    const itemIndex = gameState.items.findIndex(item => 
                        item.name === result.name && item.rarity === result.rarity
                    );
                    if (itemIndex !== -1) {
                        gameState.items[itemIndex].obtained++;
                    }
                }
                
                // 显示弹窗
                showResultModal(results, true);
                
                // 将所有结果添加到历史记录（放在最前面）
                results.reverse().forEach(item => {
                    gameState.history.unshift(item);
                    
                    // 更新统计
                    if (item.rarity === 'legendary') gameState.legendaryCount++;
                    if (item.rarity === 'epic') gameState.epicCount++;
                    if (item.rarity === 'rare') gameState.rareCount++;
                });
                
                // 更新资源显示
                updateResources();
                
                // 更新预览和信息表
                updatePreview();
                updateInfoTable();
                updateHistory();
                
                // 启用按钮
                singleDrawBtn.disabled = false;
                multiDrawBtn.disabled = false;
                lotteryDisplay.classList.remove('drawing');
                
                // 检查资源是否足够
                checkResources();
            }, 1500);
        }

        // 增加货币
        function addCurrency() {
            const amount = parseInt(prompt(`请输入要增加的${gameState.currencyName}数量:`, "135"));
            if (!isNaN(amount) && amount > 0) {
                gameState.currency += amount;
                updateResources();
                checkResources();
            }
        }

        // 检查资源是否足够
        function checkResources() {
            if (gameState.currency < gameState.singleCost) {
                singleDrawBtn.disabled = true;
            } else {
                singleDrawBtn.disabled = false;
            }
            
            if (gameState.currency < gameState.singleCost * 10) {
                multiDrawBtn.disabled = true;
            } else {
                multiDrawBtn.disabled = false;
            }
        }

        // 渲染奖品列表
        function renderItemsList() {
            itemsList.innerHTML = '';
            
            gameState.items.forEach((item, index) => {
                const itemRow = document.createElement('div');
                itemRow.className = 'item-row';
                itemRow.innerHTML = `
                    <input type="text" class="item-name-input" value="${item.name}" data-index="${index}" data-field="name">
                    <select class="item-type-select" data-index="${index}" data-field="type">
                        <option value="武器" ${item.type === '武器' ? 'selected' : ''}>武器</option>
                        <option value="资源" ${item.type === '资源' ? 'selected' : ''}>资源</option>
                        <option value="皮肤" ${item.type === '皮肤' ? 'selected' : ''}>皮肤</option>
                        <option value="舰船" ${item.type === '舰船' ? 'selected' : ''}>舰船</option>
                        <option value="道具" ${item.type === '道具' ? 'selected' : ''}>道具</option>
                    </select>
                    <select class="item-rarity-select" data-index="${index}" data-field="rarity">
                        <option value="common" ${item.rarity === 'common' ? 'selected' : ''}>普通</option>
                        <option value="rare" ${item.rarity === 'rare' ? 'selected' : ''}>稀有</option>
                        <option value="epic" ${item.rarity === 'epic' ? 'selected' : ''}>史诗</option>
                        <option value="legendary" ${item.rarity === 'legendary' ? 'selected' : ''}>传奇</option>
                    </select>
                    <input type="number" class="item-probability-input" value="${item.probability.toFixed(2)}" step="0.01" min="0" max="100" data-index="${index}" data-field="probability">
                    <input type="number" class="item-limit-input" value="${item.limit}" min="0" data-index="${index}" data-field="limit" placeholder="限量(0=无限制)">
                    <div class="item-actions">
                        <button class="btn-small btn-danger remove-item" data-index="${index}">删除</button>
                    </div>
                `;
                itemsList.appendChild(itemRow);
            });
            
            updateTotalProbability();
        }

        // 更新总概率显示
        function updateTotalProbability() {
            const total = gameState.items.reduce((sum, item) => sum + item.probability, 0);
            totalProbability.textContent = `总概率: ${total.toFixed(2)}%`;
            
            if (total < 99.9) {
                totalProbability.className = 'total-probability probability-warning';
            } else if (total > 100.1) {
                totalProbability.className = 'total-probability probability-error';
            } else {
                totalProbability.className = 'total-probability probability-ok';
            }
        }

        // 添加奖品
        function addItem() {
            gameState.items.push({
                name: "新奖品",
                type: "资源",
                rarity: "common",
                probability: 1.00,
                limit: 0,
                obtained: 0
            });
            renderItemsList();
            updatePreview();
            updateInfoTable();
        }

        // 删除奖品
        function removeItem(index) {
            gameState.items.splice(index, 1);
            renderItemsList();
            updatePreview();
            updateInfoTable();
        }

        // 保存设置
        function saveSettings() {
            // 更新货币设置
            gameState.currencyName = currencyNameInput.value;
            gameState.singleCost = parseInt(currencyCostInput.value);
            gameState.currency = parseInt(initialCurrencyInput.value);
            
            // 更新奖品设置
            const nameInputs = document.querySelectorAll('.item-name-input');
            const typeSelects = document.querySelectorAll('.item-type-select');
            const raritySelects = document.querySelectorAll('.item-rarity-select');
            const probabilityInputs = document.querySelectorAll('.item-probability-input');
            const limitInputs = document.querySelectorAll('.item-limit-input');
            
            gameState.items = [];
            for (let i = 0; i < nameInputs.length; i++) {
                gameState.items.push({
                    name: nameInputs[i].value,
                    type: typeSelects[i].value,
                    rarity: raritySelects[i].value,
                    probability: parseFloat(probabilityInputs[i].value),
                    limit: parseInt(limitInputs[i].value) || 0,
                    obtained: 0 // 重置已抽中次数
                });
            }
            
            // 更新显示
            updateResources();
            updatePreview();
            updateInfoTable();
            checkResources();
            
            alert('设置已保存！');
        }

        // 切换设置面板
        function toggleSettings() {
            settingsContent.classList.toggle('expanded');
            const toggleButton = settingsToggle.querySelector('.toggle-settings');
            toggleButton.textContent = settingsContent.classList.contains('expanded') ? '收起设置' : '展开设置';
        }

        // 显示奖品信息弹窗
        function showInfoModal() {
            updateInfoTable();
            infoModal.style.display = 'flex';
            // 弹窗打开时滚动到顶部
            infoModal.querySelector('.info-modal-content').scrollTop = 0;
        }

        // 初始化
        function init() {
            // 绑定事件
            singleDrawBtn.addEventListener('click', singleDraw);
            multiDrawBtn.addEventListener('click', multiDraw);
            addCurrencyBtn.addEventListener('click', addCurrency);
            addItemBtn.addEventListener('click', addItem);
            saveSettingsBtn.addEventListener('click', saveSettings);
            settingsToggle.addEventListener('click', toggleSettings);
            infoButton.addEventListener('click', showInfoModal);
            viewAllHistoryBtn.addEventListener('click', showAllHistory);
            closeModal.addEventListener('click', () => {
                resultModal.style.display = 'none';
            });
            closeInfoModal.addEventListener('click', () => {
                infoModal.style.display = 'none';
            });
            closeHistoryModal.addEventListener('click', () => {
                historyModal.style.display = 'none';
            });
            
            // 点击弹窗外部关闭
            resultModal.addEventListener('click', (e) => {
                if (e.target === resultModal) {
                    resultModal.style.display = 'none';
                }
            });
            
            infoModal.addEventListener('click', (e) => {
                if (e.target === infoModal) {
                    infoModal.style.display = 'none';
                }
            });
            
            historyModal.addEventListener('click', (e) => {
                if (e.target === historyModal) {
                    historyModal.style.display = 'none';
                }
            });
            
            // 使用事件委托处理动态生成的元素
            itemsList.addEventListener('input', (e) => {
                if (e.target.matches('.item-name-input, .item-type-select, .item-rarity-select, .item-probability-input, .item-limit-input')) {
                    const index = parseInt(e.target.dataset.index);
                    const field = e.target.dataset.field;
                    
                    if (field === 'probability') {
                        gameState.items[index][field] = parseFloat(e.target.value);
                    } else if (field === 'limit') {
                        gameState.items[index][field] = parseInt(e.target.value) || 0;
                    } else {
                        gameState.items[index][field] = e.target.value;
                    }
                    
                    updateTotalProbability();
                    updatePreview();
                    updateInfoTable();
                }
            });
            
            itemsList.addEventListener('click', (e) => {
                if (e.target.matches('.remove-item')) {
                    const index = parseInt(e.target.dataset.index);
                    removeItem(index);
                }
            });
            
            // 初始资源显示
            updateResources();
            renderItemsList();
            updatePreview();
            updateInfoTable();
            updateHistory();
            
            // 初始检查资源
            checkResources();
        }

        // 启动应用
        init();
    </script>
</body>
</html>