<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áé∞‰ª£ÊàòËà∞ - ÊäΩÂ•ñÊ®°ÊãüÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a4a 0%, #0d1525 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #90a4ae;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .lottery-section {
            background: rgba(30, 40, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
        }

        .preview-section {
            grid-column: 1 / -1;
            background: rgba(30, 40, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
            position: relative;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .info-button {
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid rgba(79, 195, 247, 0.5);
            color: #4fc3f7;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .preview-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .preview-item {
            background: rgba(20, 30, 48, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(79, 195, 247, 0.2);
            position: relative;
        }
        
        .preview-item-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .preview-item-rarity {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        .preview-item-probability {
            font-size: 0.7rem;
            color: #90a4ae;
        }
        
        .preview-item-type {
            font-size: 0.7rem;
            color: #90a4ae;
            margin-top: 3px;
        }
        
        .limited-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            font-size: 0.6rem;
            padding: 2px 5px;
            border-radius: 8px;
        }
        
        .settings-section {
            width: 100%;
            background: rgba(30, 40, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
            margin-top: 20px;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .settings-content {
            display: none;
            margin-top: 20px;
        }
        
        .settings-content.expanded {
            display: block;
        }
        
        .lottery-machine {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .lottery-display {
            height: 200px;
            background: rgba(20, 30, 48, 0.8);
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(79, 195, 247, 0.3);
        }
        
        .lottery-item {
            display: none;
            text-align: center;
            padding: 15px;
            animation: fadeIn 0.5s;
        }
        
        .lottery-item.active {
            display: block;
        }
        
        .item-name {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .item-rarity {
            font-size: 1.2rem;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .rarity-common {
            background: rgba(144, 164, 174, 0.3);
            color: #90a4ae;
        }
        
        .rarity-rare {
            background: rgba(41, 182, 246, 0.3);
            color: #29b6f6;
        }
        
        /* Âè≤ËØóÊîπ‰∏∫ÈáëËâ≤ */
        .rarity-epic {
            background: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }
        
        /* ‰º†ËØ¥Êîπ‰∏∫Á¥´Ëâ≤ */
        .rarity-legendary {
            background: rgba(171, 71, 188, 0.3);
            color: #ab47bc;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .single-draw {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }
        
        .multi-draw {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }
        
        .add-currency {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        
        .toggle-settings {
            background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);
        }
        
        .view-all-history {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
            margin-top: 10px;
            width: 100%;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.6);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            background: #546e7a;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .resources {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(20, 30, 48, 0.6);
            border-radius: 10px;
        }
        
        .resource-item {
            text-align: center;
        }
        
        .resource-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4fc3f7;
        }
        
        .resource-label {
            font-size: 0.9rem;
            color: #90a4ae;
        }
        
        .history-section {
            background: rgba(30, 40, 60, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4fc3f7;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .history-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(20, 30, 48, 0.6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s;
        }
        
        .history-rarity {
            width: 10px;
            height: 40px;
            border-radius: 5px;
        }
        
        .rarity-common-bg {
            background: #90a4ae;
        }
        
        .rarity-rare-bg {
            background: #29b6f6;
        }
        
        /* Âè≤ËØóÊîπ‰∏∫ÈáëËâ≤ */
        .rarity-epic-bg {
            background: #ffc107;
        }
        
        /* ‰º†ËØ¥Êîπ‰∏∫Á¥´Ëâ≤ */
        .rarity-legendary-bg {
            background: #ab47bc;
        }
        
        .history-info {
            flex: 1;
        }
        
        .history-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .history-type {
            font-size: 0.9rem;
            color: #90a4ae;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(20, 30, 48, 0.6);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4fc3f7;
            margin: 8px 0;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #90a4ae;
        }
        
        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: bold;
            color: #4fc3f7;
        }
        
        input, select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            background: rgba(20, 30, 48, 0.8);
            color: #e0e0e0;
            font-size: 1rem;
        }
        
        .items-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background: rgba(20, 30, 48, 0.6);
            border-radius: 8px;
        }
        
        .item-row {
            display: flex;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
        }
        
        .item-row:last-child {
            border-bottom: none;
        }
        
        .item-name-input {
            flex: 2;
        }
        
        .item-type-select {
            flex: 1;
        }
        
        .item-rarity-select {
            flex: 1;
        }
        
        .item-probability-input {
            flex: 1;
        }
        
        .item-limit-input {
            flex: 1;
        }
        
        .item-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.9rem;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }
        
        .total-probability {
            margin-top: 10px;
            padding: 10px;
            background: rgba(20, 30, 48, 0.8);
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .probability-warning {
            color: #ff9800;
        }
        
        .probability-error {
            color: #f44336;
        }
        
        .probability-ok {
            color: #4caf50;
        }
        
        /* ÂºπÁ™óÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .modal-content {
            background: rgba(30, 40, 60, 0.95);
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(79, 195, 247, 0.5);
            border: 2px solid rgba(79, 195, 247, 0.3);
            animation: modalFadeIn 0.5s;
            overscroll-behavior: contain;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }
        
        .modal-title {
            font-size: 1.8rem;
            color: #4fc3f7;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .modal-item {
            background: rgba(20, 30, 48, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .modal-item-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .modal-item-rarity {
            font-size: 0.9rem;
            padding: 3px 10px;
            border-radius: 15px;
            display: inline-block;
        }
        
        .modal-item-type {
            font-size: 0.8rem;
            color: #90a4ae;
            margin-top: 5px;
        }
        
        /* Â•ñÂìÅ‰ø°ÊÅØÂºπÁ™óÊ†∑Âºè */
        .info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .info-modal-content {
            background: rgba(30, 40, 60, 0.95);
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(79, 195, 247, 0.5);
            border: 2px solid rgba(79, 195, 247, 0.3);
            animation: modalFadeIn 0.5s;
            width: 800px;
            overscroll-behavior: contain;
        }
        
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .info-table th, .info-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-table th {
            background: rgba(20, 30, 48, 0.8);
            color: #4fc3f7;
            font-weight: bold;
        }
        
        .info-table tr:hover {
            background: rgba(79, 195, 247, 0.1);
        }
        
        /* ÂéÜÂè≤ËÆ∞ÂΩïÂºπÁ™óÊ†∑Âºè */
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .history-modal-content {
            background: rgba(30, 40, 60, 0.95);
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(79, 195, 247, 0.5);
            border: 2px solid rgba(79, 195, 247, 0.3);
            animation: modalFadeIn 0.5s;
            width: 600px;
            overscroll-behavior: contain;
        }
        
        .history-modal-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease-in-out;
        }
        
        .drawing {
            animation: pulse 0.3s infinite;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .preview-section {
                grid-column: 1;
            }

            .stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .preview-section {
                grid-column: 1;
            }

            .preview-items {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                max-height: 300px;
            }

            .controls {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .resources {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            button {
                width: 100%;
                flex-direction: row;
                gap: 8px;
            }

            .item-row {
                flex-direction: column;
            }

            .modal-items {
                grid-template-columns: 1fr;
            }

            .info-modal-content {
                width: 95%;
            }

            .history-modal-content {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Áé∞‰ª£ÊàòËà∞ - ÊäΩÂ•ñÊ®°ÊãüÂô®</h1>
            <p class="subtitle">‰ΩìÈ™å„ÄäÁé∞‰ª£ÊàòËà∞„Äã‰∏≠ÁöÑÊäΩÂ•ñÊ¥ªÂä®ÔºåÊµãËØï‰Ω†ÁöÑËøêÊ∞îÔºÅ</p>
        </header>
        
        <div class="main-content">
            <section class="lottery-section">
                <h2 class="section-title">ÊöóÂΩ±‰∫§Êòì</h2>
                
                <div class="lottery-machine">
                    <div class="lottery-display" id="lotteryDisplay">
                        <div class="lottery-item active" id="defaultDisplay">
                            <p>ÁÇπÂáª‰∏ãÊñπÊåâÈíÆÂºÄÂßãÊäΩÂ•ñ</p>
                            <p style="margin-top: 10px; font-size: 3rem;">üéÅ</p>
                        </div>
                    </div>
                    
                    <div class="resources">
                        <div class="resource-item">
                            <div class="resource-value" id="goldValue">40</div>
                            <div class="resource-label" id="currencyName">Á≠πÁ†Å</div>
                        </div>
                        <div class="resource-item">
                            <div class="resource-value" id="totalDraws">0</div>
                            <div class="resource-label">ÊÄªÊäΩÂ•ñÊ¨°Êï∞</div>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button class="single-draw" id="singleDrawBtn">
                            <span>ÂçïÊäΩ</span>
                            <span id="singleCost">(1Á≠πÁ†Å)</span>
                        </button>
                        <button class="multi-draw" id="multiDrawBtn">
                            <span>ÂçÅËøûÊäΩ</span>
                            <span id="multiCost">(10Á≠πÁ†Å)</span>
                        </button>
                        <button class="add-currency" id="addCurrencyBtn">
                            <span>Â¢ûÂä†Ë¥ßÂ∏Å</span>
                        </button>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">‰º†Â•áÁâ©ÂìÅ</div>
                        <div class="stat-value" id="legendaryCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Âè≤ËØóÁâ©ÂìÅ</div>
                        <div class="stat-value" id="epicCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Á®ÄÊúâÁâ©ÂìÅ</div>
                        <div class="stat-value" id="rareCount">0</div>
                    </div>
                </div>
            </section>
            
            <section class="preview-section">
                <div class="preview-header">
                    <h2 class="section-title">Â§ßÂ•ñÈ¢ÑËßà</h2>
                    <div class="info-button" id="infoButton">i</div>
                </div>
                <div class="preview-items" id="previewItems">
                    <!-- Â•ñÂìÅÈ¢ÑËßàÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
            </section>
            
            <section class="history-section">
                <h2 class="section-title">ÊäΩÂ•ñËÆ∞ÂΩï</h2>
                <div class="history-list" id="historyList">
                    <!-- ÊäΩÂ•ñËÆ∞ÂΩïÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                <button class="view-all-history" id="viewAllHistoryBtn">Êü•ÁúãÂÖ®ÈÉ®ËÆ∞ÂΩï</button>
            </section>
        </div>
        
        <section class="settings-section">
            <div class="settings-header" id="settingsToggle">
                <h2 class="section-title">Ëá™ÂÆö‰πâËÆæÁΩÆ</h2>
                <button class="toggle-settings">Â±ïÂºÄËÆæÁΩÆ</button>
            </div>
            
            <div class="settings-content" id="settingsContent">
                <div class="settings-form">
                    <div class="form-group">
                        <label for="currencyNameInput">Ë¥ßÂ∏ÅÂêçÁß∞</label>
                        <input type="text" id="currencyNameInput" value="Á≠πÁ†Å">
                    </div>
                    
                    <div class="form-group">
                        <label for="currencyCostInput">ÂçïÊ¨°ÊäΩÂ•ñÊâÄÈúÄË¥ßÂ∏Å</label>
                        <input type="number" id="currencyCostInput" value="1" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="initialCurrencyInput">ÂàùÂßãË¥ßÂ∏ÅÊï∞Èáè</label>
                        <input type="number" id="initialCurrencyInput" value="40" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>Â•ñÂìÅËÆæÁΩÆ</label>
                        <div class="items-list" id="itemsList">
                            <!-- Â•ñÂìÅÂàóË°®Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                        </div>
                        <button class="btn-small" id="addItemBtn">Ê∑ªÂä†Â•ñÂìÅ</button>
                        <div class="total-probability" id="totalProbability">
                            ÊÄªÊ¶ÇÁéá: 0.00%
                        </div>
                    </div>
                    
                    <button id="saveSettingsBtn">‰øùÂ≠òËÆæÁΩÆ</button>
                </div>
            </div>
        </section>
    </div>

    <!-- ÊäΩÂ•ñÁªìÊûúÂºπÁ™ó -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">ÊäΩÂ•ñÁªìÊûú</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-items" id="modalItems">
                <!-- Â•ñÂìÅÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
            </div>
        </div>
    </div>

    <!-- Â•ñÂìÅ‰ø°ÊÅØÂºπÁ™ó -->
    <div class="info-modal" id="infoModal">
        <div class="info-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÊâÄÊúâÂ•ñÂìÅ‰ø°ÊÅØ</h3>
                <button class="close-modal" id="closeInfoModal">&times;</button>
            </div>
            <table class="info-table">
                <thead>
                    <tr>
                        <th>Â•ñÂìÅÂêçÁß∞</th>
                        <th>Á±ªÂà´</th>
                        <th>Á®ÄÊúâÂ∫¶</th>
                        <th>Ê¶ÇÁéá</th>
                        <th>Â∑≤ÊäΩ‰∏≠Ê¨°Êï∞</th>
                        <th>ÈôêÈáè</th>
                    </tr>
                </thead>
                <tbody id="infoTableBody">
                    <!-- Â•ñÂìÅ‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂºπÁ™ó -->
    <div class="history-modal" id="historyModal">
        <div class="history-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÊâÄÊúâÊäΩÂ•ñËÆ∞ÂΩï</h3>
                <button class="close-modal" id="closeHistoryModal">&times;</button>
            </div>
            <div class="history-modal-list" id="historyModalList">
                <!-- ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
            </div>
        </div>
    </div>

    <script>
        // ÈªòËÆ§Â•ñÂìÅÊï∞ÊçÆ
        const defaultItems = [
            // ÊôÆÈÄöÁâ©ÂìÅ
            { name: "2 È´òÁ∫ßÈ±ºÈõ∑ËØ±È•µ", type: "ÈÅìÂÖ∑", rarity: "common", probability: 17.00, limit: 0, obtained: 0 },
            { name: "4 Ëâ∫ÊúØÁ°¨Â∏Å", type: "ËµÑÊ∫ê", rarity: "common", probability: 22.00, limit: 0, obtained: 0 },
            { name: "6 È´òÁ∫ßÂØºÂºπËØ±È•µ", type: "ÈÅìÂÖ∑", rarity: "common", probability: 12.50, limit: 0, obtained: 0 },
            { name: "10 Ëâ∫ÊúØÁ°¨Â∏Å", type: "ËµÑÊ∫ê", rarity: "common", probability: 8.00, limit: 0, obtained: 0 },
            { name: "1 Á≠πÁ†Å", type: "ËµÑÊ∫ê", rarity: "common", probability: 4.00, limit: 0, obtained: 0 },
            { name: "15 ÈªÑÈáë", type: "ËµÑÊ∫ê", rarity: "common", probability: 33.00, limit: 0, obtained: 0 },
            
            // Âè≤ËØóÁâ©ÂìÅ
            { name: "FREMM-EVO", type: "Ëà∞Ëàπ", rarity: "epic", probability: 0.08, limit: 1, obtained: 0 },
            { name: "RBU-10000", type: "Ê≠¶Âô®", rarity: "epic", probability: 1.53, limit: 1, obtained: 0 },
            { name: "Ëê®ÂÖãÊ£Æ(F124)", type: "Ê≠¶Âô®", rarity: "epic", probability: 0.14, limit: 1, obtained: 0 },
            
            // ‰º†Â•áÁâ©ÂìÅ
            { name: "Ë°£ÈòøÂçé", type: "Ëà∞Ëàπ", rarity: "legendary", probability: 0.09, limit: 1, obtained: 0 },
            { name: "MARK-71", type: "Ê≠¶Âô®", rarity: "legendary", probability: 0.52, limit: 2, obtained: 0 },
            { name: "MARK-45 ÈòøÊñØÊâòÂ∞î", type: "Ê≠¶Âô®", rarity: "legendary", probability: 0.23, limit: 2, obtained: 0 },
            { name: "ASN4G", type: "Ê≠¶Âô®", rarity: "legendary", probability: 0.35, limit: 2, obtained: 0 },
            { name: "ÈæüËàπ", type: "ÁöÆËÇ§", rarity: "legendary", probability: 0.50, limit: 1, obtained: 0 },
        ];

        // Ê∏∏ÊàèÁä∂ÊÄÅ
        const gameState = {
            currency: 40,
            currencyName: "Á≠πÁ†Å",
            singleCost: 1,
            totalDraws: 0,
            legendaryCount: 0,
            epicCount: 0,
            rareCount: 0,
            history: [],
            items: [...defaultItems]
        };

        // DOM ÂÖÉÁ¥†
        const lotteryDisplay = document.getElementById('lotteryDisplay');
        const singleDrawBtn = document.getElementById('singleDrawBtn');
        const multiDrawBtn = document.getElementById('multiDrawBtn');
        const addCurrencyBtn = document.getElementById('addCurrencyBtn');
        const historyList = document.getElementById('historyList');
        const goldValue = document.getElementById('goldValue');
        const currencyName = document.getElementById('currencyName');
        const singleCost = document.getElementById('singleCost');
        const multiCost = document.getElementById('multiCost');
        const totalDraws = document.getElementById('totalDraws');
        const legendaryCount = document.getElementById('legendaryCount');
        const epicCount = document.getElementById('epicCount');
        const rareCount = document.getElementById('rareCount');
        const previewItems = document.getElementById('previewItems');
        const infoButton = document.getElementById('infoButton');
        const viewAllHistoryBtn = document.getElementById('viewAllHistoryBtn');
        
        // ËÆæÁΩÆÁõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const currencyNameInput = document.getElementById('currencyNameInput');
        const currencyCostInput = document.getElementById('currencyCostInput');
        const initialCurrencyInput = document.getElementById('initialCurrencyInput');
        const itemsList = document.getElementById('itemsList');
        const addItemBtn = document.getElementById('addItemBtn');
        const totalProbability = document.getElementById('totalProbability');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const settingsToggle = document.getElementById('settingsToggle');
        const settingsContent = document.getElementById('settingsContent');
        
        // ÂºπÁ™óÁõ∏ÂÖ≥DOMÂÖÉÁ¥†
        const resultModal = document.getElementById('resultModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalItems = document.getElementById('modalItems');
        const closeModal = document.getElementById('closeModal');
        const infoModal = document.getElementById('infoModal');
        const closeInfoModal = document.getElementById('closeInfoModal');
        const infoTableBody = document.getElementById('infoTableBody');
        const historyModal = document.getElementById('historyModal');
        const closeHistoryModal = document.getElementById('closeHistoryModal');
        const historyModalList = document.getElementById('historyModalList');

        // Ê†πÊçÆÁ®ÄÊúâÂ∫¶Ëé∑ÂèñÈ¢úËâ≤Á±ª
        function getRarityClass(rarity) {
            switch(rarity) {
                case 'common': return 'rarity-common';
                case 'rare': return 'rarity-rare';
                case 'epic': return 'rarity-epic';
                case 'legendary': return 'rarity-legendary';
                default: return 'rarity-common';
            }
        }

        // Ê†πÊçÆÁ®ÄÊúâÂ∫¶Ëé∑ÂèñËÉåÊôØÈ¢úËâ≤Á±ª
        function getRarityBgClass(rarity) {
            switch(rarity) {
                case 'common': return 'rarity-common-bg';
                case 'rare': return 'rarity-rare-bg';
                case 'epic': return 'rarity-epic-bg';
                case 'legendary': return 'rarity-legendary-bg';
                default: return 'rarity-common-bg';
            }
        }

        // ÊäΩÂ•ñÂáΩÊï∞
        function drawLottery() {
            // ËøáÊª§ÊéâÂ∑≤ÊäΩÂÆåÁöÑÈôêÈáèÁâ©ÂìÅ
            const availableItems = gameState.items.filter(item => {
                return item.limit === 0 || item.obtained < item.limit;
            });
            
            // ËÆ°ÁÆóÂèØÁî®Áâ©ÂìÅÁöÑÊÄªÊ¶ÇÁéá
            const totalProbability = availableItems.reduce((sum, item) => sum + item.probability, 0);
            
            // ÁîüÊàêÈöèÊú∫Êï∞
            const rand = Math.random() * totalProbability;
            let cumulativeProbability = 0;
            
            // Ê†πÊçÆÊ¶ÇÁéáÁ°ÆÂÆöÂ•ñÂìÅ
            for (const item of availableItems) {
                cumulativeProbability += item.probability;
                if (rand < cumulativeProbability) {
                    return {...item};
                }
            }
            
            // Â¶ÇÊûúÊ¶ÇÁéáÊÄªÂíå‰∏çË∂≥ÔºåËøîÂõûÊúÄÂêé‰∏Ä‰∏™Áâ©ÂìÅ
            return {...availableItems[availableItems.length - 1]};
        }

        // Êõ¥Êñ∞ËµÑÊ∫êÊòæÁ§∫
        function updateResources() {
            goldValue.textContent = gameState.currency;
            currencyName.textContent = gameState.currencyName;
            singleCost.textContent = `(${gameState.singleCost}${gameState.currencyName})`;
            multiCost.textContent = `(${gameState.singleCost * 10}${gameState.currencyName})`;
            totalDraws.textContent = gameState.totalDraws;
            legendaryCount.textContent = gameState.legendaryCount;
            epicCount.textContent = gameState.epicCount;
            rareCount.textContent = gameState.rareCount;
        }

        // ÊòæÁ§∫ÊäΩÂ•ñÁªìÊûúÂºπÁ™ó
        function showResultModal(items, isMulti = false) {
            modalTitle.textContent = isMulti ? 'ÂçÅËøûÊäΩÁªìÊûú' : 'ÊäΩÂ•ñÁªìÊûú';
            modalItems.innerHTML = '';
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'modal-item';
                itemElement.innerHTML = `
                    <div class="modal-item-name">${item.name}</div>
                    <div class="modal-item-rarity ${getRarityClass(item.rarity)}">${getRarityText(item.rarity)}</div>
                    <div class="modal-item-type">${item.type}</div>
                `;
                modalItems.appendChild(itemElement);
            });
            
            resultModal.style.display = 'flex';
            // ÂºπÁ™óÊâìÂºÄÊó∂ÊªöÂä®Âà∞È°∂ÈÉ®
            resultModal.querySelector('.modal-content').scrollTop = 0;
        }

        // Ëé∑ÂèñÁ®ÄÊúâÂ∫¶ÊñáÊú¨
        function getRarityText(rarity) {
            switch(rarity) {
                case 'common': return 'ÊôÆÈÄö';
                case 'rare': return 'Á®ÄÊúâ';
                case 'epic': return 'Âè≤ËØó';
                case 'legendary': return '‰º†Â•á';
                default: return 'ÊôÆÈÄö';
            }
        }

        // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÊòæÁ§∫
        function updateHistory() {
            historyList.innerHTML = '';
            
            // Âè™ÊòæÁ§∫ÊúÄËøë10Êù°ËÆ∞ÂΩï
            const recentHistory = gameState.history.slice(0, 10);
            
            recentHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-rarity ${getRarityBgClass(item.rarity)}"></div>
                    <div class="history-info">
                        <div class="history-name">${item.name}</div>
                        <div class="history-type">${item.type}</div>
                    </div>
                    <div class="history-rarity-text ${getRarityClass(item.rarity)}">${getRarityText(item.rarity)}</div>
                `;
                
                historyList.appendChild(historyItem);
            });
        }

        // ÊòæÁ§∫ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂºπÁ™ó
        function showAllHistory() {
            historyModalList.innerHTML = '';
            
            gameState.history.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-rarity ${getRarityBgClass(item.rarity)}"></div>
                    <div class="history-info">
                        <div class="history-name">${item.name}</div>
                        <div class="history-type">${item.type}</div>
                    </div>
                    <div class="history-rarity-text ${getRarityClass(item.rarity)}">${getRarityText(item.rarity)}</div>
                `;
                
                historyModalList.appendChild(historyItem);
            });
            
            historyModal.style.display = 'flex';
            // ÂºπÁ™óÊâìÂºÄÊó∂ÊªöÂä®Âà∞È°∂ÈÉ®
            historyModal.querySelector('.history-modal-content').scrollTop = 0;
        }

        // Êõ¥Êñ∞Â•ñÂìÅÈ¢ÑËßà
        function updatePreview() {
            previewItems.innerHTML = '';
            
            // Á≠õÈÄâÂè≤ËØóÂíå‰º†ËØ¥Áâ©ÂìÅÔºåÂπ∂ÊåâÊ¶ÇÁéá‰ªé‰ΩéÂà∞È´òÊéíÂ∫è
            const premiumItems = gameState.items
                .filter(item => item.rarity === 'epic' || item.rarity === 'legendary')
                .sort((a, b) => a.probability - b.probability);
            
            premiumItems.forEach(item => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                let limitBadge = '';
                if (item.limit > 0) {
                    const remaining = item.limit - item.obtained;
                    limitBadge = `<div class="limited-badge">${remaining}/${item.limit}</div>`;
                }
                
                previewItem.innerHTML = `
                    ${limitBadge}
                    <div class="preview-item-name">${item.name}</div>
                    <div class="preview-item-rarity ${getRarityClass(item.rarity)}">${getRarityText(item.rarity)}</div>
                    <div class="preview-item-probability">${item.probability.toFixed(2)}%</div>
                    <div class="preview-item-type">${item.type}</div>
                `;
                
                previewItems.appendChild(previewItem);
            });
        }

        // Êõ¥Êñ∞Â•ñÂìÅ‰ø°ÊÅØË°®
        function updateInfoTable() {
            infoTableBody.innerHTML = '';
            
            // ÊåâÁ®ÄÊúâÂ∫¶ÊéíÂ∫èÔºö‰º†ËØ¥ > Âè≤ËØó > Á®ÄÊúâ > ÊôÆÈÄö
            const sortedItems = [...gameState.items].sort((a, b) => {
                const rarityOrder = { legendary: 4, epic: 3, rare: 2, common: 1 };
                return rarityOrder[b.rarity] - rarityOrder[a.rarity] || a.probability - b.probability;
            });
            
            sortedItems.forEach(item => {
                const row = document.createElement('tr');
                
                let limitText = 'Êó†ÈôêÂà∂';
                if (item.limit > 0) {
                    limitText = `${item.obtained}/${item.limit}`;
                }
                
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.type}</td>
                    <td><span class="${getRarityClass(item.rarity)}" style="padding: 3px 8px; border-radius: 10px;">${getRarityText(item.rarity)}</span></td>
                    <td>${item.probability.toFixed(2)}%</td>
                    <td>${item.obtained}</td>
                    <td>${limitText}</td>
                `;
                
                infoTableBody.appendChild(row);
            });
        }

        // ÂçïÊäΩ
        function singleDraw() {
            if (gameState.currency < gameState.singleCost) {
                alert(`${gameState.currencyName}‰∏çË∂≥ÔºÅ`);
                return;
            }
            
            // Ê∂àËÄóËµÑÊ∫ê
            gameState.currency -= gameState.singleCost;
            gameState.totalDraws++;
            
            // Á¶ÅÁî®ÊåâÈíÆ
            singleDrawBtn.disabled = true;
            multiDrawBtn.disabled = true;
            
            // Ê∑ªÂä†ÁªòÂà∂Âä®Áîª
            lotteryDisplay.classList.add('drawing');
            
            // Ê®°ÊãüÊäΩÂ•ñÂª∂Ëøü
            setTimeout(() => {
                const result = drawLottery();
                
                // Êõ¥Êñ∞Áâ©ÂìÅÁöÑÂ∑≤ÊäΩ‰∏≠Ê¨°Êï∞
                const itemIndex = gameState.items.findIndex(item => 
                    item.name === result.name && item.rarity === result.rarity
                );
                if (itemIndex !== -1) {
                    gameState.items[itemIndex].obtained++;
                }
                
                // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩïÔºàÊîæÂú®ÊúÄÂâçÈù¢Ôºâ
                gameState.history.unshift(result);
                
                // ÊòæÁ§∫ÂºπÁ™ó
                showResultModal([result]);
                
                // Êõ¥Êñ∞ÁªüËÆ°
                if (result.rarity === 'legendary') gameState.legendaryCount++;
                if (result.rarity === 'epic') gameState.epicCount++;
                if (result.rarity === 'rare') gameState.rareCount++;
                
                // Êõ¥Êñ∞ËµÑÊ∫êÊòæÁ§∫
                updateResources();
                
                // Êõ¥Êñ∞È¢ÑËßàÂíå‰ø°ÊÅØË°®
                updatePreview();
                updateInfoTable();
                updateHistory();
                
                // ÂêØÁî®ÊåâÈíÆ
                singleDrawBtn.disabled = false;
                multiDrawBtn.disabled = false;
                lotteryDisplay.classList.remove('drawing');
                
                // Ê£ÄÊü•ËµÑÊ∫êÊòØÂê¶Ë∂≥Â§ü
                checkResources();
            }, 1000);
        }

        // ÂçÅËøûÊäΩ
        function multiDraw() {
            const cost = gameState.singleCost * 10;
            if (gameState.currency < cost) {
                alert(`${gameState.currencyName}‰∏çË∂≥ÔºÅ`);
                return;
            }
            
            // Ê∂àËÄóËµÑÊ∫ê
            gameState.currency -= cost;
            gameState.totalDraws += 10;
            
            // Á¶ÅÁî®ÊåâÈíÆ
            singleDrawBtn.disabled = true;
            multiDrawBtn.disabled = true;
            
            // Ê∑ªÂä†ÁªòÂà∂Âä®Áîª
            lotteryDisplay.classList.add('drawing');
            
            // Ê®°ÊãüÊäΩÂ•ñÂª∂Ëøü
            setTimeout(() => {
                // ÊäΩ10Ê¨°
                let results = [];
                for (let i = 0; i < 10; i++) {
                    const result = drawLottery();
                    results.push(result);
                    
                    // Êõ¥Êñ∞Áâ©ÂìÅÁöÑÂ∑≤ÊäΩ‰∏≠Ê¨°Êï∞
                    const itemIndex = gameState.items.findIndex(item => 
                        item.name === result.name && item.rarity === result.rarity
                    );
                    if (itemIndex !== -1) {
                        gameState.items[itemIndex].obtained++;
                    }
                }
                
                // ÊòæÁ§∫ÂºπÁ™ó
                showResultModal(results, true);
                
                // Â∞ÜÊâÄÊúâÁªìÊûúÊ∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩïÔºàÊîæÂú®ÊúÄÂâçÈù¢Ôºâ
                results.reverse().forEach(item => {
                    gameState.history.unshift(item);
                    
                    // Êõ¥Êñ∞ÁªüËÆ°
                    if (item.rarity === 'legendary') gameState.legendaryCount++;
                    if (item.rarity === 'epic') gameState.epicCount++;
                    if (item.rarity === 'rare') gameState.rareCount++;
                });
                
                // Êõ¥Êñ∞ËµÑÊ∫êÊòæÁ§∫
                updateResources();
                
                // Êõ¥Êñ∞È¢ÑËßàÂíå‰ø°ÊÅØË°®
                updatePreview();
                updateInfoTable();
                updateHistory();
                
                // ÂêØÁî®ÊåâÈíÆ
                singleDrawBtn.disabled = false;
                multiDrawBtn.disabled = false;
                lotteryDisplay.classList.remove('drawing');
                
                // Ê£ÄÊü•ËµÑÊ∫êÊòØÂê¶Ë∂≥Â§ü
                checkResources();
            }, 1500);
        }

        // Â¢ûÂä†Ë¥ßÂ∏Å
        function addCurrency() {
            const amount = parseInt(prompt(`ËØ∑ËæìÂÖ•Ë¶ÅÂ¢ûÂä†ÁöÑ${gameState.currencyName}Êï∞Èáè:`, "135"));
            if (!isNaN(amount) && amount > 0) {
                gameState.currency += amount;
                updateResources();
                checkResources();
            }
        }

        // Ê£ÄÊü•ËµÑÊ∫êÊòØÂê¶Ë∂≥Â§ü
        function checkResources() {
            if (gameState.currency < gameState.singleCost) {
                singleDrawBtn.disabled = true;
            } else {
                singleDrawBtn.disabled = false;
            }
            
            if (gameState.currency < gameState.singleCost * 10) {
                multiDrawBtn.disabled = true;
            } else {
                multiDrawBtn.disabled = false;
            }
        }

        // Ê∏≤ÊüìÂ•ñÂìÅÂàóË°®
        function renderItemsList() {
            itemsList.innerHTML = '';
            
            gameState.items.forEach((item, index) => {
                const itemRow = document.createElement('div');
                itemRow.className = 'item-row';
                itemRow.innerHTML = `
                    <input type="text" class="item-name-input" value="${item.name}" data-index="${index}" data-field="name">
                    <select class="item-type-select" data-index="${index}" data-field="type">
                        <option value="Ê≠¶Âô®" ${item.type === 'Ê≠¶Âô®' ? 'selected' : ''}>Ê≠¶Âô®</option>
                        <option value="ËµÑÊ∫ê" ${item.type === 'ËµÑÊ∫ê' ? 'selected' : ''}>ËµÑÊ∫ê</option>
                        <option value="ÁöÆËÇ§" ${item.type === 'ÁöÆËÇ§' ? 'selected' : ''}>ÁöÆËÇ§</option>
                        <option value="Ëà∞Ëàπ" ${item.type === 'Ëà∞Ëàπ' ? 'selected' : ''}>Ëà∞Ëàπ</option>
                        <option value="ÈÅìÂÖ∑" ${item.type === 'ÈÅìÂÖ∑' ? 'selected' : ''}>ÈÅìÂÖ∑</option>
                    </select>
                    <select class="item-rarity-select" data-index="${index}" data-field="rarity">
                        <option value="common" ${item.rarity === 'common' ? 'selected' : ''}>ÊôÆÈÄö</option>
                        <option value="rare" ${item.rarity === 'rare' ? 'selected' : ''}>Á®ÄÊúâ</option>
                        <option value="epic" ${item.rarity === 'epic' ? 'selected' : ''}>Âè≤ËØó</option>
                        <option value="legendary" ${item.rarity === 'legendary' ? 'selected' : ''}>‰º†Â•á</option>
                    </select>
                    <input type="number" class="item-probability-input" value="${item.probability.toFixed(2)}" step="0.01" min="0" max="100" data-index="${index}" data-field="probability">
                    <input type="number" class="item-limit-input" value="${item.limit}" min="0" data-index="${index}" data-field="limit" placeholder="ÈôêÈáè(0=Êó†ÈôêÂà∂)">
                    <div class="item-actions">
                        <button class="btn-small btn-danger remove-item" data-index="${index}">Âà†Èô§</button>
                    </div>
                `;
                itemsList.appendChild(itemRow);
            });
            
            updateTotalProbability();
        }

        // Êõ¥Êñ∞ÊÄªÊ¶ÇÁéáÊòæÁ§∫
        function updateTotalProbability() {
            const total = gameState.items.reduce((sum, item) => sum + item.probability, 0);
            totalProbability.textContent = `ÊÄªÊ¶ÇÁéá: ${total.toFixed(2)}%`;
            
            if (total < 99.9) {
                totalProbability.className = 'total-probability probability-warning';
            } else if (total > 100.1) {
                totalProbability.className = 'total-probability probability-error';
            } else {
                totalProbability.className = 'total-probability probability-ok';
            }
        }

        // Ê∑ªÂä†Â•ñÂìÅ
        function addItem() {
            gameState.items.push({
                name: "Êñ∞Â•ñÂìÅ",
                type: "ËµÑÊ∫ê",
                rarity: "common",
                probability: 1.00,
                limit: 0,
                obtained: 0
            });
            renderItemsList();
            updatePreview();
            updateInfoTable();
        }

        // Âà†Èô§Â•ñÂìÅ
        function removeItem(index) {
            gameState.items.splice(index, 1);
            renderItemsList();
            updatePreview();
            updateInfoTable();
        }

        // ‰øùÂ≠òËÆæÁΩÆ
        function saveSettings() {
            // Êõ¥Êñ∞Ë¥ßÂ∏ÅËÆæÁΩÆ
            gameState.currencyName = currencyNameInput.value;
            gameState.singleCost = parseInt(currencyCostInput.value);
            gameState.currency = parseInt(initialCurrencyInput.value);
            
            // Êõ¥Êñ∞Â•ñÂìÅËÆæÁΩÆ
            const nameInputs = document.querySelectorAll('.item-name-input');
            const typeSelects = document.querySelectorAll('.item-type-select');
            const raritySelects = document.querySelectorAll('.item-rarity-select');
            const probabilityInputs = document.querySelectorAll('.item-probability-input');
            const limitInputs = document.querySelectorAll('.item-limit-input');
            
            gameState.items = [];
            for (let i = 0; i < nameInputs.length; i++) {
                gameState.items.push({
                    name: nameInputs[i].value,
                    type: typeSelects[i].value,
                    rarity: raritySelects[i].value,
                    probability: parseFloat(probabilityInputs[i].value),
                    limit: parseInt(limitInputs[i].value) || 0,
                    obtained: 0 // ÈáçÁΩÆÂ∑≤ÊäΩ‰∏≠Ê¨°Êï∞
                });
            }
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            updateResources();
            updatePreview();
            updateInfoTable();
            checkResources();
            
            alert('ËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
        }

        // ÂàáÊç¢ËÆæÁΩÆÈù¢Êùø
        function toggleSettings() {
            settingsContent.classList.toggle('expanded');
            const toggleButton = settingsToggle.querySelector('.toggle-settings');
            toggleButton.textContent = settingsContent.classList.contains('expanded') ? 'Êî∂Ëµ∑ËÆæÁΩÆ' : 'Â±ïÂºÄËÆæÁΩÆ';
        }

        // ÊòæÁ§∫Â•ñÂìÅ‰ø°ÊÅØÂºπÁ™ó
        function showInfoModal() {
            updateInfoTable();
            infoModal.style.display = 'flex';
            // ÂºπÁ™óÊâìÂºÄÊó∂ÊªöÂä®Âà∞È°∂ÈÉ®
            infoModal.querySelector('.info-modal-content').scrollTop = 0;
        }

        // ÂàùÂßãÂåñ
        function init() {
            // ÁªëÂÆö‰∫ã‰ª∂
            singleDrawBtn.addEventListener('click', singleDraw);
            multiDrawBtn.addEventListener('click', multiDraw);
            addCurrencyBtn.addEventListener('click', addCurrency);
            addItemBtn.addEventListener('click', addItem);
            saveSettingsBtn.addEventListener('click', saveSettings);
            settingsToggle.addEventListener('click', toggleSettings);
            infoButton.addEventListener('click', showInfoModal);
            viewAllHistoryBtn.addEventListener('click', showAllHistory);
            closeModal.addEventListener('click', () => {
                resultModal.style.display = 'none';
            });
            closeInfoModal.addEventListener('click', () => {
                infoModal.style.display = 'none';
            });
            closeHistoryModal.addEventListener('click', () => {
                historyModal.style.display = 'none';
            });
            
            // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠
            resultModal.addEventListener('click', (e) => {
                if (e.target === resultModal) {
                    resultModal.style.display = 'none';
                }
            });
            
            infoModal.addEventListener('click', (e) => {
                if (e.target === infoModal) {
                    infoModal.style.display = 'none';
                }
            });
            
            historyModal.addEventListener('click', (e) => {
                if (e.target === historyModal) {
                    historyModal.style.display = 'none';
                }
            });
            
            // ‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâòÂ§ÑÁêÜÂä®ÊÄÅÁîüÊàêÁöÑÂÖÉÁ¥†
            itemsList.addEventListener('input', (e) => {
                if (e.target.matches('.item-name-input, .item-type-select, .item-rarity-select, .item-probability-input, .item-limit-input')) {
                    const index = parseInt(e.target.dataset.index);
                    const field = e.target.dataset.field;
                    
                    if (field === 'probability') {
                        gameState.items[index][field] = parseFloat(e.target.value);
                    } else if (field === 'limit') {
                        gameState.items[index][field] = parseInt(e.target.value) || 0;
                    } else {
                        gameState.items[index][field] = e.target.value;
                    }
                    
                    updateTotalProbability();
                    updatePreview();
                    updateInfoTable();
                }
            });
            
            itemsList.addEventListener('click', (e) => {
                if (e.target.matches('.remove-item')) {
                    const index = parseInt(e.target.dataset.index);
                    removeItem(index);
                }
            });
            
            // ÂàùÂßãËµÑÊ∫êÊòæÁ§∫
            updateResources();
            renderItemsList();
            updatePreview();
            updateInfoTable();
            updateHistory();
            
            // ÂàùÂßãÊ£ÄÊü•ËµÑÊ∫ê
            checkResources();
        }

        // ÂêØÂä®Â∫îÁî®
        init();
    </script>
</body>
</html>